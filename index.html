<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Virtual Accountability</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
      background: #0f0f0f;
      color: #ffffff;
    }

    .container {
      max-width: 460px;
      margin: 0 auto;
      padding: 20px;
      padding-top: 28px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .title {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.2px;
    }

    .pill {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #1b1b1b;
      color: #bdbdbd;
      border: 1px solid #2a2a2a;
      white-space: nowrap;
    }

    .card {
      background: #141414;
      border: 1px solid #242424;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 14px;
    }

    .label {
      font-size: 12px;
      color: #a9a9a9;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.9px;
    }

    .rule {
      font-size: 16px;
      line-height: 1.35;
      font-weight: 650;
    }

    .sub {
      margin-top: 10px;
      font-size: 13px;
      color: #bdbdbd;
      line-height: 1.35;
    }

    .status {
      margin-top: 16px;
      border-radius: 14px;
      padding: 14px;
      background: #151515;
      border: 1px solid #242424;
      text-align: left;
    }

    .statusTitle {
      font-weight: 750;
      margin-bottom: 6px;
      font-size: 16px;
    }

    .statusText {
      color: #bdbdbd;
      font-size: 13px;
      line-height: 1.35;
    }

    .row {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }

    .btn {
      flex: 1;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #2a2a2a;
      background: #1a1a1a;
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
    }

    .btn:active { transform: translateY(1px); }

    .btnPrimary {
      background: #ffffff;
      color: #0f0f0f;
      border-color: #ffffff;
    }

    .btnGhost {
      background: transparent;
      color: #d6d6d6;
    }

    .tiny {
      margin-top: 10px;
      font-size: 12px;
      color: #8f8f8f;
    }

    .linkBtn {
      background: transparent;
      border: none;
      color: #bdbdbd;
      cursor: pointer;
      padding: 0;
      font-size: 13px;
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }

    .muted { color: #9a9a9a; }

    .kpiRow {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 14px;
    }

    .kpi {
      background: #141414;
      border: 1px solid #242424;
      border-radius: 14px;
      padding: 12px;
      text-align: center;
    }

    .kpiNum {
      font-weight: 850;
      font-size: 18px;
      margin-bottom: 4px;
    }

    .kpiLab {
      font-size: 11px;
      color: #a9a9a9;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .badge {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #2a2a2a;
      background: #1b1b1b;
      color: #cfcfcf;
      display: inline-block;
    }

    .badgeGreen { border-color:#1f3a2a; background:#122019; color:#9fe7c0; }
    .badgeRed { border-color:#3a1f1f; background:#201212; color:#f2a1a1; }
  </style>
</head>
<body>
  <div class="container" id="app"></div>

  <script>
    // Fake data for now (we replace this with DB + Whop later)
    const state = {
      weekLabel: "Mon → Sun",
      userRule: "No social media before 6pm",
      nextWeekRule: "",
      partner: { initial: "J", name: "James R.", handle: "@jamesruns" },
      partnerRule: "Gym 4× this week",
      statusText: "Waiting for Sunday confirmations to open.",
      history: {
        totalWeeks: 4,
        passed: 3,
        missed: 1,
        strikes: "1/3",
        pastWeeks: [
          { range: "Dec 23 – Dec 29", partner: "Jordan Lee", rule: "Meditate 10 minutes every morning", you: "Responded", partnerResp: "Responded", outcome: "Passed" },
          { range: "Dec 16 – Dec 22", partner: "Taylor Chen", rule: "No social media until 5pm", you: "Responded", partnerResp: "Responded", outcome: "Passed" },
          { range: "Dec 9 – Dec 15", partner: "Morgan Williams", rule: "Write 500 words daily", you: "Responded", partnerResp: "No response", outcome: "Missed" }
        ]
      }
    };

    function esc(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    function setRoute(route) {
      location.hash = route;
    }

    function route() {
      const hash = location.hash.replace("#", "") || "dashboard";
      if (hash === "confirm") return renderConfirm();
      if (hash === "history") return renderHistory();
      if (hash === "rules") return renderRules();
      return renderDashboard();
    }

    function renderDashboard() {
      const el = document.getElementById("app");
      el.innerHTML = `
        <div class="topbar">
          <div class="title">This Week</div>
          <div class="pill">${esc(state.weekLabel)}</div>
        </div>

        <div class="card">
          <div class="label">Your rule</div>
          <div class="rule">${esc(state.userRule)}</div>
          <div class="sub">Keep it specific, measurable, and easy to verify.</div>
        </div>

        <div class="card">
          <div class="label">Your partner</div>

          <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
            <div style="
              width:36px; height:36px; border-radius:50%;
              background:#2a2a2a; display:flex; align-items:center; justify-content:center;
              font-weight:800;
            ">${esc(state.partner.initial)}</div>

            <div>
              <div style="font-weight:800;">${esc(state.partner.name)}</div>
              <div style="font-size:12px; color:#9a9a9a;">${esc(state.partner.handle)}</div>
            </div>
          </div>

          <div class="label" style="margin-top:6px;">Partner’s rule</div>
          <div class="rule">${esc(state.partnerRule)}</div>
          <div class="sub">You’ll confirm this on Sunday.</div>
        </div>

        <div class="status">
          <div class="statusTitle">Status</div>
          <div class="statusText">${esc(state.statusText)}</div>

          <div class="row">
            <button class="btn btnPrimary" type="button" id="goConfirm">Confirm partner</button>
            <button class="btn btnGhost" type="button" id="goHistory">History</button>
          </div>

          <div class="row" style="margin-top:10px;">
            <button class="btn" type="button" id="goRules">Manage rules</button>
          </div>

          <div class="tiny">Next: wire these screens to real data + Whop.</div>
        </div>
      `;

      document.getElementById("goConfirm").onclick = () => setRoute("confirm");
      document.getElementById("goHistory").onclick = () => setRoute("history");
      document.getElementById("goRules").onclick = () => setRoute("rules");

    }

    function renderConfirm() {
      const el = document.getElementById("app");
      el.innerHTML = `
        <div class="topbar">
          <button class="linkBtn" id="backDash">← Back</button>
          <div class="pill">${esc(state.weekLabel)}</div>
        </div>

        <div class="title" style="margin-bottom:10px;">Confirm partner</div>
        <div class="muted" style="font-size:13px; margin-bottom:14px;">
          Did ${esc(state.partner.name)} follow their rule this week?
        </div>

        <div class="card">
          <div class="label">Partner’s rule</div>
          <div class="rule">${esc(state.partnerRule)}</div>
        </div>

        <div class="row">
          <button class="btn btnPrimary" type="button" id="btnPass">Pass</button>
          <button class="btn" type="button" id="btnFail">Fail</button>
        </div>

        <div class="tiny">This is fake for now. Next we’ll save this to the database.</div>
      `;

      document.getElementById("backDash").onclick = () => setRoute("dashboard");

      document.getElementById("btnPass").onclick = () => {
        state.statusText = "You confirmed your partner as Passed. Waiting for them to confirm you.";
        setRoute("dashboard");
      };

      document.getElementById("btnFail").onclick = () => {
        state.statusText = "You marked your partner as Failed. Waiting for them to confirm you.";
        setRoute("dashboard");
      };
    }

    function renderHistory() {
      const h = state.history;
      const el = document.getElementById("app");

      const list = h.pastWeeks.map(w => {
        const ok = w.outcome === "Passed";
        return `
          <div class="card">
            <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
              <div>
                <div class="muted" style="font-size:12px; margin-bottom:6px;">${esc(w.range)}</div>
                <div style="font-weight:800; margin-bottom:6px;">${esc(w.partner)}</div>
                <div class="muted" style="font-size:13px; line-height:1.35;">“${esc(w.rule)}”</div>
              </div>
              <span class="badge ${ok ? "badgeGreen" : "badgeRed"}">${esc(w.outcome)}</span>
            </div>

            <div style="margin-top:12px; display:flex; gap:12px; font-size:12px; color:#9a9a9a;">
              <div>You: <span style="color:#cfcfcf">${esc(w.you)}</span></div>
              <div>Partner: <span style="color:#cfcfcf">${esc(w.partnerResp)}</span></div>
            </div>
          </div>
        `;
      }).join("");

      el.innerHTML = `
        <div class="topbar">
          <button class="linkBtn" id="backDash">← Back</button>
          <div class="pill">${esc(state.weekLabel)}</div>
        </div>

        <div class="title" style="margin-bottom:6px;">Your History</div>
        <div class="muted" style="font-size:13px; margin-bottom:12px;">Track your accountability journey</div>

        <div class="kpiRow">
          <div class="kpi"><div class="kpiNum">${esc(h.totalWeeks)}</div><div class="kpiLab">Total</div></div>
          <div class="kpi"><div class="kpiNum">${esc(h.passed)}</div><div class="kpiLab">Passed</div></div>
          <div class="kpi"><div class="kpiNum">${esc(h.missed)}</div><div class="kpiLab">Missed</div></div>
          <div class="kpi"><div class="kpiNum">${esc(h.strikes)}</div><div class="kpiLab">Strikes</div></div>
        </div>

        <div class="label" style="margin-top:6px;">Past weeks</div>
        ${list}
      `;

      document.getElementById("backDash").onclick = () => setRoute("dashboard");
    }
    
    function renderRules() {
      const el = document.getElementById("app");
    
      // local UI state for this screen
      const hasSavedNextRule = !!(state.nextWeekRule && state.nextWeekRule.trim());
      let isEditing = !hasSavedNextRule;
    
      function draw() {
        el.innerHTML = `
          <div class="topbar">
            <button class="linkBtn" id="backDash">← Back</button>
            <div class="pill">${esc(state.weekLabel)}</div>
          </div>
    
          <div class="title" style="margin-bottom:6px;">Weekly Rules</div>
          <div class="muted" style="font-size:13px; margin-bottom:14px;">
            Set one specific, measurable rule for next week. It locks on Monday.
          </div>
    
          <div class="card">
            <div class="label">Current week (locked)</div>
            <div class="muted" style="font-size:12px; margin-bottom:6px;">Dec 29 – Jan 4</div>
            <div class="rule">${esc(state.userRule)}</div>
            <div class="sub muted">Cannot be changed</div>
          </div>
    
          <div class="card">
            <div class="label">Next week</div>
            <div class="muted" style="font-size:12px; margin-bottom:10px;">Starts Monday</div>
    
            ${
              isEditing
                ? `
                  <div class="label" style="margin-top:6px;">Set next week’s rule</div>
                  <textarea id="nextRule" rows="4" style="
                    width:100%;
                    box-sizing:border-box;
                    resize:none;
                    padding:12px;
                    border-radius:12px;
                    border:1px solid #2a2a2a;
                    background:#101010;
                    color:white;
                    font-family: inherit;
                    font-size:14px;
                    line-height:1.35;
                    outline:none;
                  " placeholder="Example: Complete 30 minutes of focused work before checking email">${esc(state.nextWeekRule || "")}</textarea>
    
                  <div style="display:flex; justify-content:space-between; margin-top:8px;">
                    <div class="tiny" id="charCount">0/200</div>
                    <div class="tiny muted">One specific rule</div>
                  </div>
    
                  <div class="row" style="margin-top:12px;">
                    <button class="btn btnPrimary" type="button" id="saveRule">Save rule</button>
                    <button class="btn btnGhost" type="button" id="cancelEdit">Cancel</button>
                  </div>
    
                  <div class="tiny" id="saveMsg" style="display:none;">Saved for next week.</div>
                `
                : `
                  <div class="label" style="margin-top:6px;">Saved rule for next week</div>
                  <div class="rule">${esc(state.nextWeekRule)}</div>
                  <div class="sub muted">You can edit this until Monday.</div>
    
                  <div class="row" style="margin-top:12px;">
                    <button class="btn" type="button" id="editNextRule">Edit next week’s rule</button>
                  </div>
                `
            }
          </div>
    
          <div class="card">
            <div class="label">How rules work</div>
            <div class="sub" style="margin-top:0;">
              1. Set one specific rule each week<br>
              2. Once the week starts (Monday), it’s locked<br>
              3. Confirm your partner on Sunday<br>
              4. Misses add strikes, 3 strikes pauses your account
            </div>
          </div>
        `;
    
        document.getElementById("backDash").onclick = () => setRoute("dashboard");
    
        if (isEditing) {
          const input = document.getElementById("nextRule");
          const count = document.getElementById("charCount");
          const msg = document.getElementById("saveMsg");
    
          function updateCount() {
            if (input.value.length > 200) input.value = input.value.slice(0, 200);
            count.textContent = `${input.value.length}/200`;
          }
          input.addEventListener("input", updateCount);
          updateCount();
    
          document.getElementById("cancelEdit").onclick = () => {
            // If nothing saved yet, cancel takes you back to dashboard
            if (!state.nextWeekRule) {
              setRoute("dashboard");
            } else {
              isEditing = false;
              draw();
            }
          };
    
          document.getElementById("saveRule").onclick = () => {
            const v = input.value.trim();
            if (!v) {
              alert("Enter a rule first.");
              return;
            }
            state.nextWeekRule = v;
    
            // Show a quick saved message, stay on page, and switch to non-edit view
            isEditing = false;
            draw();
          };
        } else {
          document.getElementById("editNextRule").onclick = () => {
            isEditing = true;
            draw();
          };
        }
      }
    
      draw();
    }

      input.addEventListener("input", updateCount);
      updateCount();

      document.getElementById("saveRule").onclick = () => {
        const v = input.value.trim();
        if (!v) {
          alert("Enter a rule first.");
          return;
        }
        state.userRule = v;
        setRoute("dashboard");
      };
    }

    window.addEventListener("hashchange", route);
    route();
  </script>
</body>
</html>


